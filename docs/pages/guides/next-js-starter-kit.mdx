---
meta:
  title: "Next Js Starter Guide"
  parentTitle: "Guides"
  description: "Create Multiplayer Documents with Authentication in Minutes"
---

In this guide, you'll learn how to build a document-based product using standard collaborative patterns.  This guide will help you to understand how to navigate, organize, and create new documents while managing user permissions and authentication.

<Figure>
  <video autoPlay loop muted playsInline>
    <source src="/images/docs/next-js-starter-kit/starter-kit.mp4" type="video/mp4" />
  </video>
</Figure>

## Features
The Next.js Starter Kit will include the following 
- Documents dashboard with pagination, drafts, groups, auto-revalidation
- Collaborative whiteboard app with a fully-featured share menu
- Authentication compatible with GitHub, Google, Auth0, and more
- Document permissions can be scoped to users, groups, and the public


## Set up the Next.js Starter Kit
The starter guide has the following structure:
```
|____types
|____liveblocks.config.ts
|____next.config.js
|____next-auth.d.ts
|____utils
|____next-env.d.ts
|____primitives
| |____Tooltip
| |____Input
| |____Skeleton
| |____Checkbox
| |____Spinnerx
| |____Dialog
| |____Popover
| |____Container
| |____Button
| |____Avatar
| |____Select
|____styles
| |____normalize.css
| |____globals.css
|____components
| |____Whiteboard
| |____ShareDialog
| |____Document
| |____Dashboard
| |____Logo
| |____Marketing
| |____Documents
| |____Cursors
| |____Badge
|____layouts
| |____Authenticated
| |____Document
| |____Dashboard
| |____Marketing
| |____Documents
| |____Error
| |____Authentication
|____constants.ts
|____icons
|____dir
|____lib
| |____server
| | |____database
| | | |____getGroup.ts
| | | |____getUser.ts
| | | |____getGroups.ts
| | | |____index.ts
| | |____notify
| | | |____notify.ts
| | | |____index.ts
| | |____auth
| | | |____getServerSession.ts
| | | |____index.ts
| | |____utils
| | | |____buildDocumentUsers.ts
| | | |____fetchLiveblocksApi.ts
| | | |____userAllowedInRooms.ts
| | | |____getDraftsGroupName.ts
| | | |____convertAccessType.ts
| | | |____buildDocuments.ts
| | | |____buildDocumentGroups.ts
| | | |____isUserDocumentOwner.ts
| | | |____index.ts
| | | |____getRandom.ts
| | |____index.ts
| | |____documents
| | | |____getDocuments.ts
| | | |____getLiveUsers.ts
| | | |____updateUserAccess.ts
| | | |____getDocumentGroups.ts
| | | |____deleteDocument.ts
| | | |____createDocument.ts
| | | |____updateGroupAccess.ts
| | | |____getNextDocuments.ts
| | | |____updateDefaultAccess.ts
| | | |____updateDocument.ts
| | | |____getDocumentUsers.ts
| | | |____removeUserAccess.ts
| | | |____index.ts
| | | |____getDocument.ts
| | | |____removeGroupAccess.ts
| | |____liveblocks
| | | |____getNextRooms.ts
| | | |____initializeStorage.ts
| | | |____getActiveUsers.ts
| | | |____getStorage.ts
| | | |____createRoom.ts
| | | |____getActiveUsersInRooms.ts
| | | |____deleteRoom.ts
| | | |____updateRoom.ts
| | | |____deleteStorage.ts
| | | |____getRooms.ts
| | | |____getRoom.ts
| | | |____authorize.ts
| | | |____index.ts
| |____client
| | |____database
| | | |____getGroup.ts
| | | |____getUser.ts
| | | |____getGroups.ts
| | | |____index.ts
| | |____utils
| | | |____getDocumentAccess.ts
| | | |____fetchApiEndpoint.ts
| | | |____index.ts
| | |____hooks
| | | |____useDocumentsFunctionSWR.ts
| | | |____index.ts
| | | |____usePaginatedDocumentsSWR.ts
| | |____index.ts
| | |____documents
| | | |____getDocuments.ts
| | | |____getLiveUsers.ts
| | | |____updateUserAccess.ts
| | | |____updateDocumentName.ts
| | | |____getDocumentGroups.ts
| | | |____deleteDocument.ts
| | | |____createDocument.ts
| | | |____updateGroupAccess.ts
| | | |____getNextDocuments.ts
| | | |____updateDefaultAccess.ts
| | | |____getDocumentUsers.ts
| | | |____removeUserAccess.ts
| | | |____index.ts
| | | |____getDocument.ts
| | | |____removeGroupAccess.ts
|____tsconfig.json
|____data
| |____colors.ts
| |____groups.ts
| |____users.ts
|____pages
| |____index.tsx
| |____whiteboard
| | |____[id].tsx
| |____index.module.css
| |____dashboard
| | |____index.tsx
| | |____drafts.tsx
| | |____group
| | | |____[groupId].tsx
| |____api
| | |____database
| | | |____groups.ts
| | | |____users.ts
| | |____auth
| | | |____[...nextauth].ts
| | |____liveblocks
| | | |____documents
| | | | |____next.ts
| | | | |____[documentId]
| | | | | |____defaultAccess.ts
| | | | | |____groups.ts
| | | | | |____users.ts
| | | | | |____index.ts
| | | | |____liveUsers.ts
| | | | |____index.ts
| | | | |____create.ts
| | | |____auth.ts
| |_____app.tsx
| |____signin.tsx
|____structure
|
``` 
The important thing to note is that there are primitives, which are base level components such as buttons (think of these as the small building blocks of a page), components, which you can think of as multiplayer impementations (cursors, badges, etc), pages, which render document level experiences and both server side and client side methods which contain the logic to create and modify documments.

### Liveblocks Configuration
If you already have a Liveblocks Development account, you may skip to step 4.
1. Create an account at [liveblocks.io](https://liveblocks.io])
2. Navigate to the [dashboard](https://liveblocks.io/dashboard) and click "Add
   project..."
3. Create a new project with "Development" as the environment.
4. Go to "API keys" on the side menu, reveal your secret key, and copy it

<Figure>
  <video autoPlay loop muted playsInline>
    <source src="/images/docs/next-js-starter-kit/create-api-key.mp4" type="video/mp4" />
  </video>
</Figure>

5. Install the starter kit by running 
```ts 
npx create-liveblocks-app --next
```
6. Enter the `.env.local` file, which is located alongside `package.json` at the root level in your project.
6. Place your secret key into the file as `LIVEBLOCKS_SECRET_KEY`.

Your `.env.local` file should contain a line similar to this:

```ts
LIVEBLOCKS_SECRET_KEY=sk_dev_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

At this point, Liveblocks can be run with 

```ts
npm run dev
```

### Authentication
The Liveblocks starter kit uses [NextAuth.js](https://next-auth.js.org/) for
authentication, so many authentication providers can be configured
with minimal code changes. A demo authentication system is used by default, but it's easy to add real providers, such as GitHub, Google, Auth0.

### GitHub Authentication
 
#### Getting the secrets
1. Go to [Developer Settings](https://github.com/settings/apps) on GitHub and
   click "New GitHub App"
2. Enter an app name (e.g. `Liveblocks Starter Kit (dev)`). You'll need a new
   app for each environment, so it's helpful to place "dev" in the name.
3. Add a homepage URLâ€”this isn't important now, so a placeholder will do.
4. Find the "Callback URL" input just below, and add your local development URL
   (e.g. `http://localhost:3000`)
5. Look for the "Webhook" section and make sure to uncheck "Active".
6. Use the remaining default settings and press "Create GitHub App"

<Figure>
  <video autoPlay loop muted playsInline>
    <source src="/images/docs/next-js-starter-kit/github-auth.mp4" type="video/mp4" />
  </video>
</Figure>

7. On the next page under "Client secrets", press "Generate a new client
   secret".
8. Copy this secret into the `/.env.local` file as `GITHUB_SECRET`
9. Go back to the previous page and find the "Client ID" near the top. Copy this
   into your `.env.local` file as `GITHUB_ID`

Almost there! `.env.local` should now look similar to this:

```
LIVEBLOCKS_SECRET_KEY=sk_dev_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
GITHUB_SECRET=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
GITHUB_ID=XXXXXXXXXXXXXXXXXXXX
```

#### Add the authentication provider

Next, go to `/pages/api/auth/[...nextAuth].ts` in your project, and add a GitHub
provider:

```ts
import GithubProvider from "next-auth/providers/github";
export const authOptions = {
  // ...
  providers: {
    GithubProvider({
      clientId: process.env.GITHUB_CLIENT_ID as string,
      clientSecret: process.env.GITHUB_CLIENT_SECRET as string,
    }),
  }
};
```

And remove `CredentialsProvider` from the same object, as this was only necessary for the demo authentication system:
```ts
export const authOptions = {
  // ...
  providers: {
    // Delete from here
    CredentialsProvider({
      // ...
    }),
    // Until here
  }
};
```
GitHub authentication is now complete!

### How to sign up - add yourself as a user

We haven't set up a database, so we're temporarily using the `/data` folder
instead. Before any user can sign in, they need to be added to `/data/users.ts`.
Navigate there and add your details, for example, if you're signing in with
`yourname@example.com`:

```ts
{
  id: "yourname@example.com",
  name: "Your Name",
  avatar: "https://liveblocks.io/avatars/avatar-0.png",
  groupIds: ["product", "engineering", "design"],
},
```

## Assorted info

### Async Fetching and Error Handling

This starter kit makes extensive use of the following programming pattern for
fetching async resources:

```ts
const { data, error } = await getDocument({
  /* ... */
});
// An error has occured
if (error) {
  // { code: 400, message: "Document not found", suggestion: "Please check the URL is..." }
  console.log(error);
  return;
}
// Success, but result is empty
if (!data) {
  return;
// { code: 404, message: "Room not found", suggestion: "Check that you're on the correct page"}
}
// Success
// { name: "my-document", id: "hIas7GuihgHF8Fhv8Sskg",  ... }
console.log(data);
```

### Document functions

Much of the starter kit's power is in the `/lib/server/documents` directory. The
functions in these files allow you to edit your documents easily and return
type-safe objects. For example in an API endpoint:

```ts
import { createDocument } from "../../lib/server";
export default async function (req, res) {
  // Create a new document
  const { data, error } = await createDocument(req, res, {
    name: "My document",
    type: "whiteboard",
    userId: "charlie.layne@example.com",
  });
  // ...
}
```

These functions can also be leveraged on the client side. To do so, simply import from the
`/lib/client` folder, and omit `res` and `res` instead. This works by calling an
API endpoint for you and then calling the `/lib/server` function.

```tsx
import { createDocument } from "../../lib/client";
export function CreateDocumentButton() {
  async function handleCreateDocument() {
    // Create a new document
    const { data, error } = await createDocument({
      name: "My document",
      type: "whiteboard",
      userId: "charlie.layne@example.com",
    });
    // ...
  }
  return <button onClick={handleCreateDocument}>New document</button>;
}
```
Functions that return data can be used with [SWR hooks](https://swr.vercel.app/) that automatically update your data in components.  For example, `getDocumentUsers` returns a list of users with access to the room: 

```tsx
// Convert from this
const { data, error } = await getDocumentUsers({
  documentId: "my-document-id",
});
// To this
const { data, error } = useDocumentsFunctionSWR([
  getDocumentUsers,
  {
    documentId: "my-document-id",
  },
]);
```

Here's a working example:

```tsx
import { getDocumentUsers, useDocumentsFunctionSWR } from "../../lib/client";
export function ListUsers() {
  // Get users attached to a document and update every 1000ms
  const { data: users, error: usersError } = useDocumentsFunctionSWR(
    [
      getDocumentUsers,
      {
        documentId: "my-document-id",
      },
    ],
    { refreshInterval: 1000 }
  );
  if (usersError) {
    return <div>Error</div>;
  }
  if (!users) {
    return <div>Loading...</div>;
  }
  return (
    <ul>
      {users.map((user) => (
        <li>user.name</li>
      ))}
    </ul>
  );
}
```

### How to extend the `Document` type

If you'd like to add a new property to `Document`, it's simple. First, edit the
`Document` type in `/types/documents.ts`:

```ts
export type Document = {
  // Your new property
  randomNumber: number;
  //...
};
```

Then modify the return value in `/lib/server/utils/buildDocuments.ts`. This is a
function that converts a Liveblocks room into your custom document format:

```ts
// Return our custom Document format
const document: Document = {
  randomNumber: Math.random(),
  // ...
};
```

Next, run the following command to check for problems:

```
npm run typecheck
```

If no errors are returned, the document properties were successfully extended.

### How to extend the `User` & `Session` type

Similar to the way we extend the `Document` type, we can also extend the `User` and `Session` type.

Adding a new property to `User`/`Session` is simple. First, edit the `User` type
in `/types/data.ts`.

```ts
export type User = {
  // Your new property
  randomNumber: number;
  // ...
};
```

Then make sure to return this new property in `/lib/server/database/getUser.ts`.

```ts
return { randomNumber: Math.random() /* ... */ };
```

The new property will now be available to use in your app:

```tsx
// randomNumber: Math.random(),
console.log(session.user.info.randomNumber);
```

#### Adding this to your Liveblocks app (optional)

If you'd like your new property to be available inside your Liveblocks app (e.g.
the React hooks used in whiteboard), you must modify `UserInfo` in
`/liveblocks.config.ts`

```tsx
export type UserInfo = Pick<User, "randomNumber" /* ... */>;
```

Then modify `/pages/api/liveblocks/auth.ts`. First, we'll give an anonymous user
a property:

```ts
// Anonymous user info
const anonymousUser: User = {
  randomNumber: Math.random(),
  // ...
};
```

Next, we'll get the signed-in user's property:

```ts
// Get current user info from session (defined in /pages/api/auth/[...nextauth].ts)
// If no session found, this is a logged out/anonymous user
const {
  randomNumber,
  // ...
} = session?.user.info ?? anonymousUser;
```

And then pass this info to `authorize`:

```ts
// Get Liveblocks access token
const { data, error } = await authorize({
  userInfo: { randomNumber /* ... */ },
  // ...
});
```

To make sure to check everything's hooked up correctly:

```
npm run typecheck
```

Once that's working, the new property can then be used in your app:

```tsx
// My random number
const myRandomNumber = useSelf((me) => me.info.randomNumber);
// An array of everyone else's random numbers
const everyonesRandomNumbers = useOthersMapped(
  (other) => other.info.randomNumber
);
```

### Adding a database

To add a database you need to modify the following async functions to return the
correct properties:

- `/lib/server/database/getGroup.ts`
- `/lib/server/database/getGroups.ts`
- `/lib/server/database/getUser.ts`

You can then remove the `/data` folder. Everything else should work as expected.

